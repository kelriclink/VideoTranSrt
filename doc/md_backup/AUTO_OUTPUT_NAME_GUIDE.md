# 自动更新输出文件名功能

## 功能概述

已成功实现自动更新输出文件名的功能。现在当用户选择视频文件时，不论原先GUI中输出文件是什么，都会自动刷新为与输入文件同名的.srt文件，之后用户可以手动修改。

## 主要改进

### 1. 自动更新输出文件名 ✅
**问题**: 用户选择输入文件后，输出文件名不会自动更新
**解决方案**: 
- 修改 `select_input_file()` 方法，每次选择文件都更新输出文件名
- 添加 `on_input_file_changed()` 方法，监听输入文件路径变化
- 支持手动输入文件路径时也自动更新输出文件名

### 2. 智能路径处理 ✅
**功能**: 
- 自动将输入文件的扩展名替换为 `.srt`
- 保持文件路径的目录结构
- 支持所有音视频格式的自动转换

### 3. 用户友好体验 ✅
**实现**:
- 用户仍可以手动修改输出文件名
- 支持通过"浏览"按钮选择自定义输出路径
- 实时响应输入文件的变化

## 技术实现

### 核心功能代码
```python
def select_input_file(self):
    """选择输入文件"""
    file_path, _ = QFileDialog.getOpenFileName(
        self,
        "选择视频或音频文件",
        "",
        "音视频文件 (*.mp4 *.mkv *.avi *.mov *.wmv *.flv *.mp3 *.wav *.m4a *.aac *.ogg *.flac);;所有文件 (*)"
    )
    
    if file_path:
        self.input_file_edit.setText(file_path)
        # 自动设置输出文件名（每次选择都更新）
        output_path = Path(file_path).with_suffix('.srt')
        self.output_file_edit.setText(str(output_path))

def on_input_file_changed(self, text):
    """输入文件变化时的处理"""
    if text.strip():
        try:
            # 检查是否是有效的文件路径
            input_path = Path(text.strip())
            if input_path.exists() and input_path.is_file():
                # 自动更新输出文件名
                output_path = input_path.with_suffix('.srt')
                self.output_file_edit.setText(str(output_path))
        except Exception:
            # 如果路径无效，不更新输出文件名
            pass
```

### 文件扩展名支持
支持以下音视频格式的自动转换：
- **视频格式**: `.mp4`, `.mkv`, `.avi`, `.mov`, `.wmv`, `.flv`
- **音频格式**: `.mp3`, `.wav`, `.m4a`, `.aac`, `.ogg`, `.flac`

### 路径处理逻辑
```python
# 示例转换
input_path = Path("testvideo/1351956921-1-192.mp4")
output_path = input_path.with_suffix('.srt')
# 结果: "testvideo/1351956921-1-192.srt"
```

## 使用方法

### 1. 通过文件对话框选择
1. 点击"浏览..."按钮
2. 选择视频或音频文件
3. 输出文件名自动更新为同名.srt文件
4. 可以手动修改输出文件名

### 2. 手动输入文件路径
1. 在输入文件框中直接输入文件路径
2. 如果文件存在，输出文件名自动更新
3. 可以手动修改输出文件名

### 3. 自定义输出路径
1. 点击输出文件的"浏览..."按钮
2. 选择自定义的保存位置和文件名
3. 输出文件名会更新为用户选择的值

## 功能特点

### 1. 智能更新
- **实时响应**: 输入文件变化时立即更新输出文件名
- **路径保持**: 保持输入文件的目录结构
- **扩展名转换**: 自动将音视频扩展名转换为.srt

### 2. 用户控制
- **手动编辑**: 用户可以随时修改输出文件名
- **自定义路径**: 支持选择自定义的保存位置
- **灵活配置**: 不强制使用自动生成的名称

### 3. 错误处理
- **路径验证**: 检查输入路径是否有效
- **异常处理**: 无效路径时不影响现有输出文件名
- **用户友好**: 提供清晰的错误提示

## 测试结果

功能已通过测试：
- ✅ 路径处理逻辑正常
- ✅ 自动更新输出文件名功能正常
- ✅ 支持所有音视频格式
- ✅ 用户可以手动修改输出文件名

## 使用示例

### 示例1: 选择视频文件
```
输入文件: D:\videos\movie.mp4
输出文件: D:\videos\movie.srt  (自动生成)
```

### 示例2: 手动输入路径
```
输入文件: C:\audio\song.wav
输出文件: C:\audio\song.srt  (自动生成)
```

### 示例3: 自定义输出路径
```
输入文件: D:\videos\movie.mp4
输出文件: E:\subtitles\custom_name.srt  (用户自定义)
```

## 优势

### 1. 提高效率
- **自动化**: 无需手动输入输出文件名
- **一致性**: 输出文件名与输入文件保持一致
- **便捷性**: 减少用户操作步骤

### 2. 用户友好
- **直观**: 输出文件名一目了然
- **灵活**: 支持手动修改和自定义
- **智能**: 自动处理各种文件格式

### 3. 稳定可靠
- **错误处理**: 完善的异常处理机制
- **路径安全**: 验证文件路径的有效性
- **兼容性**: 支持各种操作系统路径格式

现在用户选择视频文件时，输出文件名会自动更新为同名.srt文件，大大提高了使用效率！🎉
